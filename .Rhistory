q()
general_bass_solution <- function(t,p,q){
x <- exp(-(p+q)*t)
r <- (1-x)/(1+q/p*x)
return(r)
}
times <- seq(0,1/(p+q),length.out = 1e2)
p <- 1
q <- 1
times <- seq(0,1/(p+q),length.out = 1e2)
y <- general_bass_solution(times,p,q)
plot(times,g)
general_bass_solution <- function(t,p,q){
x <- exp(-(p+q)*t)
r <- (1-x)/(1+q/p*x)
return(r)
}
p <- 1
q <- 1
times <- seq(0,1/(p+q),length.out = 1e2)
y <- general_bass_solution(times,p,q)
plot(times,y)
plot(times,y,type='l'
)
times <- seq(0,3/(p+q),length.out = 1e2)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l')
plot(times,y,type='l',ylim = c(0,1))
times <- seq(0,5/(p+q),length.out = 1e2)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- 1
q <- .5
times <- seq(0,5/(p+q),length.out = 1e2)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- 1
q <- .1
times <- seq(0,5/(p+q),length.out = 1e2)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- .1
q <- .1
times <- seq(0,5/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- 1e-3
q <- .1
times <- seq(0,5/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
times <- seq(0,10/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- 1e-3
q <- .1
times <- seq(0,10/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- 1e-6
q <- .1
times <- seq(0,10/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- 1e-6
q <- .1
p <- 1e-6
q <- .5
times <- seq(0,10/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
times <- seq(0,100/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
times <- seq(0,50/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
times <- seq(0,20/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
q <- .9
times <- seq(0,20/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
p <- 1e-6
q <- .9
times <- seq(0,20/(p+q),length.out = 1e3)
y <- general_bass_solution(times,p,q)
plot(times,y,type='l',ylim = c(0,1))
install.packages('deSolve')
library(dplyr)
library(dplyr)
mus <- runif(10)
sigmas <- runif(10)
lapply(1:10,function(i){
rnorm(100,mus[i],sigmas[i])
}) %>% do.call(cbind,.)
set.seed(1)
mus <- runif(10)
sigmas <- runif(10)
A  <- matrixrunif(10**2,-1,1)
A  <- matrix(runif(10**2,-1,1),nrow=10,ncol=10)
A
X <- lapply(1:10,function(i){
rnorm(100,mus[i],sigmas[i])
}) %>% do.call(cbind,.)
Y <- A%*%X
X <- lapply(1:10,function(i){
rnorm(100,mus[i],sigmas[i])
}) %>% do.call(cbind,.) %>% t
Y <- A%*%X
Y
library(dplyr)
set.seed(1)
mus <- runif(10)
sigmas <- runif(10)
A  <- matrix(runif(10**2,-1,1),nrow=10,ncol=10)
X <- lapply(1:10,function(i){
rnorm(100,mus[i],sigmas[i])
}) %>% do.call(cbind,.)
Y <- A%*%t(X)
Y
library(dplyr)
set.seed(1)
N <- 5
mus <- runif(N)
sigmas <- runif(N)
A  <- matrix(runif(N**2,-1,1),nrow=10,ncol=10)
X <- lapply(1:N,function(i){
rnorm(100,mus[i],sigmas[i])
}) %>% do.call(cbind,.)
Y <- A%*%t(X)
library(dplyr)
set.seed(1)
N <- 5
mus <- runif(N)
sigmas <- runif(N)
A  <- matrix(runif(N**2,-1,1),nrow=N,ncol=N)
X <- lapply(1:N,function(i){
rnorm(100,mus[i],sigmas[i])
}) %>% do.call(cbind,.)
Y <- A%*%t(X)
pairs(Y)
pairs(Y)
pairs(Y)
pairs(Y)
Y
Y <- t(A%*%t(X))
pairs(Y)
ggpairs(as.data.frame(Y))
library(ggplot2)
library(GGally)
install.packages('GGally')
install.packages("GGally")
shiny::runApp('GitHub/economia_popular/tablero')
?tabsetPanel\
?tabsetPanel
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
runApp('GitHub/economia_popular/tablero')
library(eph)
eph::canastas_reg_example
eph::calculate_poverty
eph::adulto_equivalente
eph::calculate_poverty
get_poverty_lines(regional = TRUE)
View(get_poverty_lines(regional = TRUE))
library(eph)
library(dplyr)
organize_panels
?organize_panels
library(ggplot2)
library(dplyr)
rm(list=ls())
gc()
load('base_ep.RData')
df <- individual_03.hoy %>% filter(YEAR>=2018)
setwd("~/GitHub/economia_popular")
library(ggplot2)
library(dplyr)
rm(list=ls())
gc()
load('base_ep.RData')
df <- individual_03.hoy %>% filter(YEAR>=2018)
rm(individual_03.hoy)
tray_ing <- df %>%
group_by(CODUSU,NRO_HOGAR) %>%
mutate(n_eph = n()) %>%
filter(n_eph > 1) %>%
mutate(HOGAR = paste(CODUSU,NRO_HOGAR)) %>%
group_by(YEAR,TRIMESTER,HOGAR) %>%
summarise(
ITF = first(ITF),
PONDIH = first(PONDIH),
CBT = first(CBT_hogar),
situacion = first(situacion),
CODUSU = first(CODUSU),
NRO_HOGAR = first(NRO_HOGAR)
) %>%
ungroup() %>%
mutate(periodo = as.character(YEAR + 0.25*(TRIMESTER-1)))
hogares_filter <- tray_ing %>% mutate(HOGAR = paste(CODUSU,NRO_HOGAR)) %>% ungroup() %>% select(HOGAR) %>% unlist %>% unique
tray_ing %>%
ungroup() %>%
mutate(HOGAR = paste(CODUSU,NRO_HOGAR)) %>%
filter(HOGAR %in% sample(hogares_filter,100)) %>%
mutate(periodo = YEAR + 0.25*(TRIMESTER-1)) %>%
ggplot(aes(x=periodo,y=ITF/CBT,group=HOGAR))+
geom_line() +
geom_point() +
scale_y_log10()
periodos_ref <- tray_ing %>%
group_by(HOGAR) %>%
summarise(periodos = paste(periodo,collapse=' '),
situaciones = {
x <- situacion
names(x) <- periodo
list(c(x))},
PONDIHs = {
x <- PONDIH
names(x) <- periodo
list(c(x))})
T_mat <- array(0,c(length(unique(tray_ing$periodo))-1,3,3),list(unique(tray_ing$periodo)[2:length(unique(tray_ing$periodo))-1],c('indigente','pobre','no_pobre'),c('indigente','pobre','no_pobre')))
periodo <- dimnames(T_mat)[[1]][1]
for(periodo in dimnames(T_mat)[[1]]){
print(periodo)
periodo_next <- periodo %>% as.numeric %>% {.+.25} %>% as.character
pat <- paste(periodo, periodo_next)
t_id <- grep(pat,periodos_ref$periodos)
print(length(t_id))
if(length(t_id)>0){
for(x in t_id){
peso1 <- periodos_ref$PONDIHs[[x]][periodo]
peso2 <- periodos_ref$PONDIHs[[x]][periodo_next]
s1 <- periodos_ref$situaciones[[x]][periodo]
s2 <- periodos_ref$situaciones[[x]][periodo_next]
if(!any(is.na(c(s1,s2)))){
if(is.na(T_mat[periodo,s1,s2])) T_mat[periodo,s1,s2] <- 0
T_mat[periodo,s1,s2] <- T_mat[periodo,s1,s2] + (peso+peso2)/2
}
}
}
}
T_mat <- array(0,c(length(unique(tray_ing$periodo))-1,3,3),list(unique(tray_ing$periodo)[2:length(unique(tray_ing$periodo))-1],c('indigente','pobre','no_pobre'),c('indigente','pobre','no_pobre')))
periodo <- dimnames(T_mat)[[1]][1]
for(periodo in dimnames(T_mat)[[1]]){
print(periodo)
periodo_next <- periodo %>% as.numeric %>% {.+.25} %>% as.character
pat <- paste(periodo, periodo_next)
t_id <- grep(pat,periodos_ref$periodos)
print(length(t_id))
if(length(t_id)>0){
for(x in t_id){
peso1 <- periodos_ref$PONDIHs[[x]][periodo]
peso2 <- periodos_ref$PONDIHs[[x]][periodo_next]
s1 <- periodos_ref$situaciones[[x]][periodo]
s2 <- periodos_ref$situaciones[[x]][periodo_next]
if(!any(is.na(c(s1,s2)))){
if(is.na(T_mat[periodo,s1,s2])) T_mat[periodo,s1,s2] <- 0
T_mat[periodo,s1,s2] <- T_mat[periodo,s1,s2] + (peso1+peso2)/2
}
}
}
}
T_mat
T_mat <- array(0,c(3,3,length(unique(tray_ing$periodo))-1),list(c('indigente','pobre','no_pobre'),c('indigente','pobre','no_pobre'),unique(tray_ing$periodo)[2:length(unique(tray_ing$periodo))-1]))
periodo <- dimnames(T_mat)[[1]][1]
for(periodo in dimnames(T_mat)[[1]]){
print(periodo)
periodo_next <- periodo %>% as.numeric %>% {.+.25} %>% as.character
pat <- paste(periodo, periodo_next)
t_id <- grep(pat,periodos_ref$periodos)
print(length(t_id))
if(length(t_id)>0){
for(x in t_id){
peso1 <- periodos_ref$PONDIHs[[x]][periodo]
peso2 <- periodos_ref$PONDIHs[[x]][periodo_next]
s1 <- periodos_ref$situaciones[[x]][periodo]
s2 <- periodos_ref$situaciones[[x]][periodo_next]
if(!any(is.na(c(s1,s2)))){
if(is.na(T_mat[periodo,s1,s2])) T_mat[periodo,s1,s2] <- 0
T_mat[periodo,s1,s2] <- T_mat[periodo,s1,s2] + (peso1+peso2)/2
}
}
}
}
T_mat <- array(0,c(3,3,length(unique(tray_ing$periodo))-1),list(c('indigente','pobre','no_pobre'),c('indigente','pobre','no_pobre'),unique(tray_ing$periodo)[2:length(unique(tray_ing$periodo))-1]))
periodo <- dimnames(T_mat)[[3]][1]
periodo
T_mat_w <- array(0,c(3,3,length(unique(tray_ing$periodo))-1),list(c('indigente','pobre','no_pobre'),c('indigente','pobre','no_pobre'),unique(tray_ing$periodo)[2:length(unique(tray_ing$periodo))-1]))
periodo <- dimnames(T_mat_w)[[3]][1]
for(periodo in dimnames(T_mat_w)[[3]]){
print(periodo)
periodo_next <- periodo %>% as.numeric %>% {.+.25} %>% as.character
pat <- paste(periodo, periodo_next)
t_id <- grep(pat,periodos_ref$periodos)
print(length(t_id))
if(length(t_id)>0){
for(x in t_id){
peso1 <- periodos_ref$PONDIHs[[x]][periodo]
peso2 <- periodos_ref$PONDIHs[[x]][periodo_next]
s1 <- periodos_ref$situaciones[[x]][periodo]
s2 <- periodos_ref$situaciones[[x]][periodo_next]
if(!any(is.na(c(s1,s2)))){
if(is.na(T_mat_w[s1,s2,periodo])) T_mat_w[s1,s2,periodo] <- 0
T_mat_w[s1,s2,periodo] <- T_mat_w[s1,s2,periodo] + (peso1+peso2)/2
}
}
}
}
T_mat_w
dimnames(T_mat_w)[[3]]
calculate_tabulates
dimnames(T_mat_w)[[3]]
periodo
s1
T_mat <- T_mat_w
T_mat[s1,,periodo]
T_mat <- T_mat_w
for(periodo in dimnames(T_mat_w)[[3]]){
for(s1 in dimnames(T_mat_w[[1]])){
T_mat <- T_mat[s1,,periodo] / sum(T_mat[s1,,periodo])
}
}
T_mat
T_mat <- T_mat_w
for(periodo in dimnames(T_mat_w)[[3]]){
for(s1 in dimnames(T_mat_w[[1]])){
T_mat <- T_mat[s1,,periodo] / sum(T_mat[s1,,periodo])
}
}
T_mat
periodo
s1
T_mat_w
T_mat <- T_mat_w
for(periodo in dimnames(T_mat_w)[[3]]){
for(s1 in dimnames(T_mat_w)[[1]]){
T_mat <- T_mat[s1,,periodo] / sum(T_mat[s1,,periodo])
}
}
s1
periodo
T_mat[s1,,periodo]
T_mat
T_mat_w
T_mat <- T_mat_w
T_mat <- T_mat_w
for(periodo in dimnames(T_mat_w)[[3]]){
for(s1 in dimnames(T_mat_w)[[1]]){
T_mat[s1,,periodo] <- T_mat[s1,,periodo] / sum(T_mat[s1,,periodo])
}
}
T_mat
save.image('jugando_a_transiciones.RData')
